<h1 id="two-factor-authentication-2fa">Two-Factor Authentication (2FA)</h1>
<h3 id="min-build-time">‚è± 15 Min Build Time</h3>
<h2 id="why-build-two-factor-authentication">Why build two factor authentication?</h2>
<p>Enterprises are increasingly challenged to keep sensitive information from falling into the wrong hands. This means that we can no longer trust old online authentication systems that rely solely on usernames and passwords, especially as security breaches grow in frequency, severity and sophistication.</p>
<p>With the <a href="https://www.messagebird.com/en/verify">MessageBird Verify API</a>, you can implement two factor authentication (2FA) solutions to provide an additional layer of account security by verifying the user‚Äôs password with a second authentication token and in turn, secure customer data, block fraudulent accounts, and safeguard key transactions in a matter of minutes. The most common use case involves the application of one-time passwords (OTP) generated by hardware tokens or authenticator apps or directly sent to the user‚Äôs mobile phone via SMS text messaging.</p>
<p>In this MessageBird Developer Guide, we‚Äôll introduce the <a href="https://www.messagebird.com/en/verify">MessageBird Verify API</a> and show you how to build a runnable application in Go. The application is a prototype for a two-factor authentication system deployed by a fictious online banking application called <em>BirdBank</em>.</p>
<p>We will walk you through the following steps:</p>
<ul>
<li>Asking for the phone number</li>
<li>Sending a verification code</li>
<li>Verifying the code</li>
</ul>
<p>You can follow along this tutorial to build the whole application from scratch or, if you want to see it in action right away, you can also <a href="https://github.com/messagebirdguides/verify-guide-go">download, clone or fork the sample repository from GitHub</a>.</p>
<h2 id="getting-started">Getting started</h2>
<p>We‚Äôll be building our single-page web application with:</p>
<ul>
<li>the latest version of <a href="https://golang.org">Go</a>, and</li>
<li>the <a href="https://github.com/messagebird/go-rest-api">MessageBird‚Äôs REST API package for Go</a></li>
</ul>
<p>Before we get started, let‚Äôs make sure you‚Äôve downloaded the latest version of Go. If not, you can easily download it <a href="https://golang.org">here</a> for free.</p>
<h2 id="project-setup">Project Setup</h2>
<p>First, let‚Äôs create a folder for your application - you can call it whatever you like. Now, in this folder, let‚Äôs create the following subfolders:</p>
<ul>
<li><code>views</code></li>
<li><code>views/layouts</code></li>
</ul>
<p>We‚Äôll use the following packages from the Go standard library to build our routes and views:</p>
<ul>
<li><code>net/http</code>: A HTTP package for building our routes and a simple http server.</li>
<li><code>html/template</code>: A HTML template library for building views.</li>
</ul>
<p>From the MessageBird Go REST API package, we‚Äôll import the following packages:</p>
<ul>
<li><code>github.com/messagebird/go-rest-api</code>: The MessageBird core client package.</li>
<li><code>github.com/messagebird/go-rest-api</code>: The MessageBird Verify package.</li>
</ul>
<h3 id="dependencies">Dependencies</h3>
<p>To keep things straightforward and get you up and running as fast as possible, we‚Äôll use only packages from the Go standard library and the MessageBird Client library.</p>
<h4 id="create-your-api-key">Create your API Key üîë</h4>
<p>To enable the MessageBird SDK, we need to provide an access key for the API. MessageBird provides keys in <em>live</em> and <em>test</em> modes. To get this application running, we will need to create and use a live API access key. Read more about the difference between test and live API keys [here] (https://support.messagebird.com/hc/en-us/articles/360000670709-What-is-the-difference-between-a-live-key-and-a-test-key-).</p>
<p>Let‚Äôs create your live API access key. First, go to the <a href="https://dashboard.messagebird.com/en/user/index">MessageBird Dashboard</a>; if you have already created an API key it will be shown right there. If you do not see any key on the dashboard or if you‚Äôre unsure whether this key is in <em>live</em> mode, go to the <em>Developers</em> section and open the <a href="https://dashboard.messagebird.com/en/developers/access">API access (REST) tab</a>. Here, you can create new API keys and manage your existing ones.</p>
<p>If you are having any issues creating your API key, please reach out to our Customer Support team at support@messagebird.com.</p>
<p><strong>Pro-tip:</strong> To keep our demonstration code simple, we will be saving our API key in <code>main.go</code>. However, hardcoding your credentials in the code is a risky practice that should never be used in production applications. A better method, also recommended by the <a href="https://12factor.net/">Twelve-Factor App Definition</a>, is to use environment variables. You can use open source packages such as <a href="https://github.com/joho/godotenv">GoDotEnv</a> to read your API key from a <code>.env</code> file into your Go application. Your <code>.env</code> file should be written as follows:</p>
<pre class="env"><code>MESSAGEBIRD_API_KEY=YOUR-API-KEY</code></pre>
<p>To use <a href="https://github.com/joho/godotenv">GoDotEnv</a> in your application, install it by running:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="ex">go</span> get -u github.com/joho/godotenv</a></code></pre></div>
<p>Then, import it in your application:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode go"><code class="sourceCode go"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="kw">import</span> (</a>
<a class="sourceLine" id="cb3-2" data-line-number="2">  <span class="co">// Other imported packages</span></a>
<a class="sourceLine" id="cb3-3" data-line-number="3">  <span class="st">&quot;os&quot;</span></a>
<a class="sourceLine" id="cb3-4" data-line-number="4"></a>
<a class="sourceLine" id="cb3-5" data-line-number="5">  <span class="st">&quot;github.com/joho/godotenv&quot;</span></a>
<a class="sourceLine" id="cb3-6" data-line-number="6">)</a>
<a class="sourceLine" id="cb3-7" data-line-number="7"></a>
<a class="sourceLine" id="cb3-8" data-line-number="8"><span class="kw">func</span> main(){</a>
<a class="sourceLine" id="cb3-9" data-line-number="9">  <span class="co">// GoDotEnv loads any &quot;.env&quot; file located in the same directory as main.go</span></a>
<a class="sourceLine" id="cb3-10" data-line-number="10">  err := godotenv.Load()</a>
<a class="sourceLine" id="cb3-11" data-line-number="11">  <span class="kw">if</span> err != <span class="ot">nil</span> {</a>
<a class="sourceLine" id="cb3-12" data-line-number="12">    log.Fatal(<span class="st">&quot;Error loading .env file&quot;</span>)</a>
<a class="sourceLine" id="cb3-13" data-line-number="13">  }</a>
<a class="sourceLine" id="cb3-14" data-line-number="14"></a>
<a class="sourceLine" id="cb3-15" data-line-number="15">  <span class="co">// Store the value for the key &quot;MESSAGEBIRD_API_KEY&quot; in the loaded &#39;.env&#39; file.</span></a>
<a class="sourceLine" id="cb3-16" data-line-number="16">  apikey := os.Getenv(<span class="st">&quot;MESSAGEBIRD_API_KEY&quot;</span>)</a>
<a class="sourceLine" id="cb3-17" data-line-number="17"></a>
<a class="sourceLine" id="cb3-18" data-line-number="18">  <span class="co">// The rest of your application ...</span></a>
<a class="sourceLine" id="cb3-19" data-line-number="19">}</a></code></pre></div>
<h2 id="initialize-the-messagebird-client">Initialize the MessageBird Client</h2>
<p>Let‚Äôs now install the <a href="https://github.com/messagebird/go-rest-api">MessageBird‚Äôs REST API package for Go</a> by running:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode go"><code class="sourceCode go"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="kw">go</span> get -u github.com/messagebird/<span class="kw">go</span>-rest-api</a></code></pre></div>
<p>In your project folder which we created earlier, let‚Äôs create a <code>main.go</code> file, and write the following code:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode go"><code class="sourceCode go"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="kw">package</span> main</a>
<a class="sourceLine" id="cb5-2" data-line-number="2"></a>
<a class="sourceLine" id="cb5-3" data-line-number="3"><span class="kw">import</span> (</a>
<a class="sourceLine" id="cb5-4" data-line-number="4">  <span class="st">&quot;github.com/messagebird/go-rest-api&quot;</span></a>
<a class="sourceLine" id="cb5-5" data-line-number="5">)</a>
<a class="sourceLine" id="cb5-6" data-line-number="6"></a>
<a class="sourceLine" id="cb5-7" data-line-number="7"><span class="kw">func</span> main(){</a>
<a class="sourceLine" id="cb5-8" data-line-number="8">  client := messagebird.New(&lt;enter-your-apikey&gt;)</a>
<a class="sourceLine" id="cb5-9" data-line-number="9">}</a></code></pre></div>
<h3 id="routes">Routes</h3>
<p>To make the structure of our web application clear, we‚Äôll first stub the routes that we need. We need three routes:</p>
<ul>
<li>Step 1: A route to ask for the user‚Äôs phone number.</li>
<li>Step 2: A route for the user to enter a verification code.</li>
<li>Step 3: A route to show if the verification code is valid.</li>
</ul>
<p>To write these routes, we need to modify <code>main.go</code> to look like the following:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode go"><code class="sourceCode go"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="kw">package</span> main</a>
<a class="sourceLine" id="cb6-2" data-line-number="2"></a>
<a class="sourceLine" id="cb6-3" data-line-number="3"><span class="kw">import</span> (</a>
<a class="sourceLine" id="cb6-4" data-line-number="4">  <span class="st">&quot;fmt&quot;</span></a>
<a class="sourceLine" id="cb6-5" data-line-number="5">  <span class="st">&quot;net/http&quot;</span></a>
<a class="sourceLine" id="cb6-6" data-line-number="6"></a>
<a class="sourceLine" id="cb6-7" data-line-number="7">  <span class="st">&quot;github.com/messagebird/go-rest-api&quot;</span></a>
<a class="sourceLine" id="cb6-8" data-line-number="8">)</a>
<a class="sourceLine" id="cb6-9" data-line-number="9"></a>
<a class="sourceLine" id="cb6-10" data-line-number="10"><span class="kw">func</span> step1(w http.ResponseWriter, r *http.Request){</a>
<a class="sourceLine" id="cb6-11" data-line-number="11">  <span class="co">// Do nothing</span></a>
<a class="sourceLine" id="cb6-12" data-line-number="12">  fmt.Fprintln(<span class="st">&quot;This is step 1&quot;</span>)</a>
<a class="sourceLine" id="cb6-13" data-line-number="13">}</a>
<a class="sourceLine" id="cb6-14" data-line-number="14"></a>
<a class="sourceLine" id="cb6-15" data-line-number="15"><span class="kw">func</span> step2(w http.ResponseWriter, r *http.Request){</a>
<a class="sourceLine" id="cb6-16" data-line-number="16">  <span class="co">// Do nothing</span></a>
<a class="sourceLine" id="cb6-17" data-line-number="17">  fmt.Fprintln(<span class="st">&quot;This is step 2&quot;</span>)</a>
<a class="sourceLine" id="cb6-18" data-line-number="18">}</a>
<a class="sourceLine" id="cb6-19" data-line-number="19"></a>
<a class="sourceLine" id="cb6-20" data-line-number="20"><span class="kw">func</span> step3(w http.ResponseWriter, r *http.Request){</a>
<a class="sourceLine" id="cb6-21" data-line-number="21">  <span class="co">// Do nothing</span></a>
<a class="sourceLine" id="cb6-22" data-line-number="22">  fmt.Fprintln(<span class="st">&quot;This is step 3&quot;</span>)</a>
<a class="sourceLine" id="cb6-23" data-line-number="23">}</a>
<a class="sourceLine" id="cb6-24" data-line-number="24"></a>
<a class="sourceLine" id="cb6-25" data-line-number="25"><span class="kw">func</span> main(){</a>
<a class="sourceLine" id="cb6-26" data-line-number="26">  client := messagebird.New(&lt;enter-your-apikey&gt;)</a>
<a class="sourceLine" id="cb6-27" data-line-number="27"></a>
<a class="sourceLine" id="cb6-28" data-line-number="28">  http.HandleFunc(<span class="st">&quot;/&quot;</span>,step1)</a>
<a class="sourceLine" id="cb6-29" data-line-number="29">  http.HandleFunc(<span class="st">&quot;/step2&quot;</span>,step2)</a>
<a class="sourceLine" id="cb6-30" data-line-number="30">  http.HandleFunc(<span class="st">&quot;/step3&quot;</span>,step3)</a>
<a class="sourceLine" id="cb6-31" data-line-number="31"></a>
<a class="sourceLine" id="cb6-32" data-line-number="32">  err := http.ListenAndServe(<span class="st">&quot;:8080&quot;</span>,<span class="ot">nil</span>)</a>
<a class="sourceLine" id="cb6-33" data-line-number="33">  <span class="kw">if</span> err != <span class="ot">nil</span> {</a>
<a class="sourceLine" id="cb6-34" data-line-number="34">    <span class="bu">panic</span>(err)</a>
<a class="sourceLine" id="cb6-35" data-line-number="35">  }</a>
<a class="sourceLine" id="cb6-36" data-line-number="36">}</a></code></pre></div>
<p>Here, we‚Äôve defined a HTTP handler for each route, and assigned each handler to a corresponding URL path. At the bottom of our <code>main()</code> function, we start a HTTP server on port 8080.</p>
<p><strong>Pro-tip:</strong> We use <code>http.ListenAndServe</code> to start our HTTP server here, but you may want to use <code>http.ListenAndServeTLS</code> to secure your application‚Äôs communication over the web with TLS/SSL.</p>
<h3 id="views">Views</h3>
<p>Now that we‚Äôve got our routes set up, we can start writing templates to render for each route. We‚Äôll be defining four views:</p>
<ul>
<li><code>views/layouts/default</code>: The base HTML template we will use with all our views.</li>
<li><code>views/step1</code>: View for step 1.</li>
<li><code>views/step2</code>: View for step 2.</li>
<li><code>views/step3</code>: View for step 3.</li>
</ul>
<p>Let‚Äôs create the following files in your project folder:</p>
<ul>
<li><code>views/layouts/default.gohtml</code></li>
<li><code>views/step1.gohtml</code></li>
<li><code>views/step2.gohtml</code></li>
<li><code>views/step3.gohtml</code></li>
</ul>
<p>The <code>.gohtml</code> files will contain our Go HTML template code for each of our views, and our ‚Äúdefault‚Äù base template.</p>
<p>First, we‚Äôll write the base template. In <code>default.gohtml</code>, write the following code:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode html"><code class="sourceCode html"><a class="sourceLine" id="cb7-1" data-line-number="1">{{ define &quot;default&quot; }}</a>
<a class="sourceLine" id="cb7-2" data-line-number="2"><span class="dt">&lt;!DOCTYPE </span>html<span class="dt">&gt;</span></a>
<a class="sourceLine" id="cb7-3" data-line-number="3">  <span class="kw">&lt;head&gt;</span></a>
<a class="sourceLine" id="cb7-4" data-line-number="4">    <span class="kw">&lt;meta</span><span class="ot"> charset=</span><span class="st">&quot;utf-8&quot;</span><span class="kw">&gt;</span></a>
<a class="sourceLine" id="cb7-5" data-line-number="5">    <span class="kw">&lt;meta</span><span class="ot"> http-equiv=</span><span class="st">&quot;X-UA-Compatible&quot;</span><span class="ot"> content=</span><span class="st">&quot;IE=edge&quot;</span><span class="kw">&gt;</span></a>
<a class="sourceLine" id="cb7-6" data-line-number="6">    <span class="kw">&lt;title&gt;</span>MessageBird Verify Example<span class="kw">&lt;/title&gt;</span></a>
<a class="sourceLine" id="cb7-7" data-line-number="7">    <span class="kw">&lt;meta</span><span class="ot"> name=</span><span class="st">&quot;description&quot;</span><span class="ot"> content=</span><span class="st">&quot;&quot;</span><span class="kw">&gt;</span></a>
<a class="sourceLine" id="cb7-8" data-line-number="8">    <span class="kw">&lt;meta</span><span class="ot"> name=</span><span class="st">&quot;viewport&quot;</span><span class="ot"> content=</span><span class="st">&quot;width=device-width, initial-scale=1&quot;</span><span class="kw">&gt;</span></a>
<a class="sourceLine" id="cb7-9" data-line-number="9">    <span class="kw">&lt;link</span><span class="ot"> rel=</span><span class="st">&quot;stylesheet&quot;</span><span class="ot"> href=</span><span class="st">&quot;&quot;</span><span class="ot"> type=</span><span class="st">&quot;text/css&quot;</span><span class="kw">/&gt;</span></a>
<a class="sourceLine" id="cb7-10" data-line-number="10">  <span class="kw">&lt;/head&gt;</span></a>
<a class="sourceLine" id="cb7-11" data-line-number="11">  <span class="kw">&lt;body&gt;</span></a>
<a class="sourceLine" id="cb7-12" data-line-number="12">    <span class="kw">&lt;main</span><span class="ot"> class=</span><span class="st">&quot;&quot;</span><span class="kw">&gt;</span></a>
<a class="sourceLine" id="cb7-13" data-line-number="13">    <span class="kw">&lt;h1&gt;</span>MessageBird Verify Example<span class="kw">&lt;/h1&gt;</span></a>
<a class="sourceLine" id="cb7-14" data-line-number="14">    {{ template &quot;yield&quot; . }}</a>
<a class="sourceLine" id="cb7-15" data-line-number="15">    <span class="kw">&lt;/main&gt;</span></a>
<a class="sourceLine" id="cb7-16" data-line-number="16">  <span class="kw">&lt;/body&gt;</span></a>
<a class="sourceLine" id="cb7-17" data-line-number="17"><span class="kw">&lt;/html&gt;</span></a>
<a class="sourceLine" id="cb7-18" data-line-number="18">{{ end }}</a></code></pre></div>
<p>Notice that in <code>default.gohtml</code>, we are calling <code>{{ template &quot;yield&quot; . }}</code>. This tells the Go templates package that the contents of any template named ‚Äúyield‚Äù should be rendered in its place when the template is executed.</p>
<p>Next, modify the <code>import</code> call in <code>main.go</code> to add our HTML template package:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode go"><code class="sourceCode go"><a class="sourceLine" id="cb8-1" data-line-number="1"><span class="kw">import</span> (</a>
<a class="sourceLine" id="cb8-2" data-line-number="2">  <span class="st">&quot;fmt&quot;</span></a>
<a class="sourceLine" id="cb8-3" data-line-number="3">  <span class="st">&quot;net/http&quot;</span></a>
<a class="sourceLine" id="cb8-4" data-line-number="4">  <span class="st">&quot;html/template&quot;</span></a>
<a class="sourceLine" id="cb8-5" data-line-number="5"></a>
<a class="sourceLine" id="cb8-6" data-line-number="6">  <span class="st">&quot;github.com/messagebird/go-rest-api&quot;</span></a>
<a class="sourceLine" id="cb8-7" data-line-number="7">)</a></code></pre></div>
<h2 id="asking-for-the-phone-number">Asking for the phone number</h2>
<p>The first step in verifying a user‚Äôs phone number is asking them to provide their phone number. So, in <code>step1.gohtml</code>, let‚Äôs write the following code:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode html"><code class="sourceCode html"><a class="sourceLine" id="cb9-1" data-line-number="1">{{ define &quot;yield&quot; }}</a>
<a class="sourceLine" id="cb9-2" data-line-number="2"><span class="kw">&lt;p&gt;</span>Please enter your phone number (in international format, starting with +) to receive a verification code:<span class="kw">&lt;/p&gt;</span></a>
<a class="sourceLine" id="cb9-3" data-line-number="3"><span class="kw">&lt;form</span><span class="ot"> method=</span><span class="st">&quot;post&quot;</span><span class="ot"> action=</span><span class="st">&quot;/step2&quot;</span><span class="kw">&gt;</span></a>
<a class="sourceLine" id="cb9-4" data-line-number="4">    <span class="kw">&lt;input</span><span class="ot"> type=</span><span class="st">&quot;tel&quot;</span><span class="ot"> name=</span><span class="st">&quot;number&quot;</span> <span class="kw">/&gt;</span></a>
<a class="sourceLine" id="cb9-5" data-line-number="5">    <span class="kw">&lt;input</span><span class="ot"> type=</span><span class="st">&quot;submit&quot;</span><span class="ot"> value=</span><span class="st">&quot;Send code&quot;</span> <span class="kw">/&gt;</span></a>
<a class="sourceLine" id="cb9-6" data-line-number="6"><span class="kw">&lt;/form&gt;</span></a>
<a class="sourceLine" id="cb9-7" data-line-number="7">{{ end }}</a></code></pre></div>
<p>Here in <code>step1.gohtml</code>, we see that our template is defined as ‚Äúyield‚Äù, allowing <code>default.gohtml</code> to render it when both templates are executed together by calling the <code>ExecuteTemplate()</code> method.</p>
<p>To get the view to render, open <code>main.go</code> and rewrite the <code>step1()</code> handler function:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode go"><code class="sourceCode go"><a class="sourceLine" id="cb10-1" data-line-number="1"><span class="kw">func</span> step1(w http.ResponseWriter, r *http.Request) {</a>
<a class="sourceLine" id="cb10-2" data-line-number="2">    t, err := template.ParseFiles(<span class="st">&quot;views/step1.gohtml&quot;</span>,<span class="st">&quot;views/layouts/default.gohtml&quot;</span>)</a>
<a class="sourceLine" id="cb10-3" data-line-number="3">    <span class="kw">if</span> err != <span class="ot">nil</span> {</a>
<a class="sourceLine" id="cb10-4" data-line-number="4">        log.Fatal(err)</a>
<a class="sourceLine" id="cb10-5" data-line-number="5">    }</a>
<a class="sourceLine" id="cb10-6" data-line-number="6">    err = t.ExecuteTemplate(w, <span class="st">&quot;default&quot;</span>, <span class="ot">nil</span>)</a>
<a class="sourceLine" id="cb10-7" data-line-number="7">    <span class="kw">if</span> err != <span class="ot">nil</span> {</a>
<a class="sourceLine" id="cb10-8" data-line-number="8">        log.Fatal(err)</a>
<a class="sourceLine" id="cb10-9" data-line-number="9">  }</a>
<a class="sourceLine" id="cb10-10" data-line-number="10">}</a></code></pre></div>
<p>We tell the <code>step1()</code> handler to read both the ‚Äúviews/step1.gohtml‚Äù and ‚Äúviews/layouts/default.gohtml‚Äù template files. Then we call the <code>ExecuteTemplate</code> method, telling it render the ‚Äúdefault‚Äù template.</p>
<h2 id="writing-a-renderdefaulttemplate-function">Writing a RenderDefaultTemplate() function</h2>
<p>At this point, we know that the handlers for all three steps must:</p>
<ul>
<li>Parse the <code>default.gohtml</code> template file and one other template file.</li>
<li>Execute the template.</li>
<li>Handle errors from the <code>ParseFiles()</code> and <code>ExecuteTemplate()</code> methods.</li>
</ul>
<p>We can write a <code>RenderDefaultTemplate()</code> helper function to make these calls, keeping our code DRY:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode go"><code class="sourceCode go"><a class="sourceLine" id="cb11-1" data-line-number="1"><span class="kw">func</span> RenderDefaultTemplate(w http.ResponseWriter,thisView <span class="dt">string</span>){</a>
<a class="sourceLine" id="cb11-2" data-line-number="2">  <span class="co">// Create an array of strings to contain our list of templates to render.</span></a>
<a class="sourceLine" id="cb11-3" data-line-number="3">  renderthis := []<span class="dt">string</span>{thisView, <span class="st">&quot;views/layouts/default.gohtml&quot;</span>}</a>
<a class="sourceLine" id="cb11-4" data-line-number="4">    t, err := template.ParseFiles(renderthis...)</a>
<a class="sourceLine" id="cb11-5" data-line-number="5">    <span class="kw">if</span> err != <span class="ot">nil</span> {</a>
<a class="sourceLine" id="cb11-6" data-line-number="6">        log.Fatal(err)</a>
<a class="sourceLine" id="cb11-7" data-line-number="7">    }</a>
<a class="sourceLine" id="cb11-8" data-line-number="8">    err = t.ExecuteTemplate(w, <span class="st">&quot;default&quot;</span>, <span class="ot">nil</span>)</a>
<a class="sourceLine" id="cb11-9" data-line-number="9">    <span class="kw">if</span> err != <span class="ot">nil</span> {</a>
<a class="sourceLine" id="cb11-10" data-line-number="10">        log.Fatal(err)</a>
<a class="sourceLine" id="cb11-11" data-line-number="11">    }</a>
<a class="sourceLine" id="cb11-12" data-line-number="12">}</a></code></pre></div>
<p>Then, we can go ahead and rewrite all our handlers in <code>main.go</code>:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode go"><code class="sourceCode go"><a class="sourceLine" id="cb12-1" data-line-number="1"><span class="kw">func</span> step1(w http.ResponseWriter, r *http.Request){</a>
<a class="sourceLine" id="cb12-2" data-line-number="2">  RenderDefaultTemplate(w,<span class="st">&quot;views/step1.gohtml&quot;</span>)</a>
<a class="sourceLine" id="cb12-3" data-line-number="3">}</a>
<a class="sourceLine" id="cb12-4" data-line-number="4"></a>
<a class="sourceLine" id="cb12-5" data-line-number="5"><span class="kw">func</span> step2(w http.ResponseWriter, r *http.Request){</a>
<a class="sourceLine" id="cb12-6" data-line-number="6">  RenderDefaultTemplate(w,<span class="st">&quot;views/step2.gohtml&quot;</span>)</a>
<a class="sourceLine" id="cb12-7" data-line-number="7">}</a>
<a class="sourceLine" id="cb12-8" data-line-number="8"></a>
<a class="sourceLine" id="cb12-9" data-line-number="9"><span class="kw">func</span> step3(w http.ResponseWriter, r *http.Request){</a>
<a class="sourceLine" id="cb12-10" data-line-number="10">  RenderDefaultTemplate(w,<span class="st">&quot;views/step3.gohtml&quot;</span>)</a>
<a class="sourceLine" id="cb12-11" data-line-number="11">}</a></code></pre></div>
<h2 id="sending-a-verification-code">Sending a verification code</h2>
<p>Once we‚Äôve collected the number, we can send a verification message to the user‚Äôs mobile device. MessageBird‚Äôs Verify API takes care of generating a random token, so you don‚Äôt have to do this yourself. Codes are numeric and six digits by default. If you want to customize the length of the code or configure other options, you can refer to the <a href="https://developers.messagebird.com/docs/verify#verify-request">Verify API documentation</a>.</p>
<p>Next, we need a page with <code>step2()</code> for our user to enter their verification code.</p>
<p>In <code>step2.gohtml</code>, let‚Äôs write the following code:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode html"><code class="sourceCode html"><a class="sourceLine" id="cb13-1" data-line-number="1">{{ define &quot;yield&quot; }}</a>
<a class="sourceLine" id="cb13-2" data-line-number="2"><span class="kw">&lt;p&gt;</span>We have sent you a verification code!<span class="kw">&lt;/p&gt;</span></a>
<a class="sourceLine" id="cb13-3" data-line-number="3"><span class="kw">&lt;p&gt;</span>Please enter the code here:<span class="kw">&lt;/p&gt;</span></a>
<a class="sourceLine" id="cb13-4" data-line-number="4"><span class="kw">&lt;form</span><span class="ot"> method=</span><span class="st">&quot;post&quot;</span><span class="ot"> action=</span><span class="st">&quot;/step3&quot;</span><span class="kw">&gt;</span></a>
<a class="sourceLine" id="cb13-5" data-line-number="5">    <span class="kw">&lt;input</span><span class="ot"> type=</span><span class="st">&quot;text&quot;</span><span class="ot"> name=</span><span class="st">&quot;token&quot;</span> <span class="kw">/&gt;</span></a>
<a class="sourceLine" id="cb13-6" data-line-number="6">    <span class="kw">&lt;input</span><span class="ot"> type=</span><span class="st">&quot;submit&quot;</span><span class="ot"> value=</span><span class="st">&quot;Check code&quot;</span> <span class="kw">/&gt;</span></a>
<a class="sourceLine" id="cb13-7" data-line-number="7"><span class="kw">&lt;/form&gt;</span></a>
<a class="sourceLine" id="cb13-8" data-line-number="8">{{ end }}</a></code></pre></div>
<p>Then, modify <code>step2()</code> in <code>main.go</code> to look like the following:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode go"><code class="sourceCode go"><a class="sourceLine" id="cb14-1" data-line-number="1"><span class="kw">func</span> step2(w http.ResponseWriter, r *http.Request) {</a>
<a class="sourceLine" id="cb14-2" data-line-number="2">    <span class="kw">var</span> err <span class="dt">error</span></a>
<a class="sourceLine" id="cb14-3" data-line-number="3"></a>
<a class="sourceLine" id="cb14-4" data-line-number="4">    r.ParseForm()</a>
<a class="sourceLine" id="cb14-5" data-line-number="5">    num := r.FormValue(<span class="st">&quot;number&quot;</span>)</a>
<a class="sourceLine" id="cb14-6" data-line-number="6">    clientVerify, err = client.NewVerify(num, <span class="ot">nil</span>)</a>
<a class="sourceLine" id="cb14-7" data-line-number="7">    <span class="kw">if</span> err != <span class="ot">nil</span> {</a>
<a class="sourceLine" id="cb14-8" data-line-number="8">        log.Println(err)</a>
<a class="sourceLine" id="cb14-9" data-line-number="9">    }</a>
<a class="sourceLine" id="cb14-10" data-line-number="10">    RenderDefaultTemplate(w, <span class="st">&quot;views/step2.gohtml&quot;</span>)</a>
<a class="sourceLine" id="cb14-11" data-line-number="11">}</a></code></pre></div>
<p>In the <code>step2()</code> handler, we‚Äôre using the <code>ParseForm()</code> method to read data submitted through the form in <code>step1.gohtml</code>. We can access these values using the <code>FormValue(&lt;key&gt;)</code> method.</p>
<p>Here, we get the user‚Äôs phone number using <code>FormValue(&quot;number&quot;)</code>, and pass it into <code>verify.Create()</code>, that sends this data to the MessageBird servers. The MessageBird servers then responds with <code>*verify.Verify</code> object that contains information we need for the verification process. Because we want to share the response received from the MessageBird server with the <code>step3</code> handler, we need to create two global variables in <code>main.go</code>.</p>
<p>Modify the <code>import</code> statement to look like this:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode go"><code class="sourceCode go"><a class="sourceLine" id="cb15-1" data-line-number="1"><span class="kw">import</span> (</a>
<a class="sourceLine" id="cb15-2" data-line-number="2">  <span class="st">&quot;html/template&quot;</span></a>
<a class="sourceLine" id="cb15-3" data-line-number="3">  <span class="st">&quot;log&quot;</span></a>
<a class="sourceLine" id="cb15-4" data-line-number="4">  <span class="st">&quot;net/http&quot;</span></a>
<a class="sourceLine" id="cb15-5" data-line-number="5"></a>
<a class="sourceLine" id="cb15-6" data-line-number="6">  <span class="st">&quot;github.com/messagebird/go-rest-api&quot;</span></a>
<a class="sourceLine" id="cb15-7" data-line-number="7">  <span class="st">&quot;github.com/messagebird/go-rest-api/verify&quot;</span></a>
<a class="sourceLine" id="cb15-8" data-line-number="8">)</a></code></pre></div>
<p>Just under our <code>import</code> statement in <code>main.go</code>, create the following variables:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode go"><code class="sourceCode go"><a class="sourceLine" id="cb16-1" data-line-number="1"><span class="kw">import</span> (</a>
<a class="sourceLine" id="cb16-2" data-line-number="2">  <span class="co">//...</span></a>
<a class="sourceLine" id="cb16-3" data-line-number="3">)</a>
<a class="sourceLine" id="cb16-4" data-line-number="4"></a>
<a class="sourceLine" id="cb16-5" data-line-number="5"><span class="kw">var</span> (</a>
<a class="sourceLine" id="cb16-6" data-line-number="6">    <span class="co">// Stores the MessageBird Client object</span></a>
<a class="sourceLine" id="cb16-7" data-line-number="7">  client       *messagebird.Client</a>
<a class="sourceLine" id="cb16-8" data-line-number="8">  <span class="co">// Stores the Verify object received from the MessageBird servers</span></a>
<a class="sourceLine" id="cb16-9" data-line-number="9">    clientVerify *verify.Verify</a>
<a class="sourceLine" id="cb16-10" data-line-number="10">)</a>
<a class="sourceLine" id="cb16-11" data-line-number="11"></a>
<a class="sourceLine" id="cb16-12" data-line-number="12"><span class="co">// The rest of the application...</span></a></code></pre></div>
<p>Then, modify <code>step2()</code>:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode go"><code class="sourceCode go"><a class="sourceLine" id="cb17-1" data-line-number="1"><span class="kw">func</span> step2(w http.ResponseWriter, r *http.Request) {</a>
<a class="sourceLine" id="cb17-2" data-line-number="2">    <span class="kw">var</span> err <span class="dt">error</span></a>
<a class="sourceLine" id="cb17-3" data-line-number="3"></a>
<a class="sourceLine" id="cb17-4" data-line-number="4">    r.ParseForm()</a>
<a class="sourceLine" id="cb17-5" data-line-number="5">    num := r.FormValue(<span class="st">&quot;number&quot;</span>)</a>
<a class="sourceLine" id="cb17-6" data-line-number="6">    clientVerify, err = verify.Create(client, num, <span class="ot">nil</span>)</a>
<a class="sourceLine" id="cb17-7" data-line-number="7">    <span class="kw">if</span> err != <span class="ot">nil</span> {</a>
<a class="sourceLine" id="cb17-8" data-line-number="8">        log.Println(err)</a>
<a class="sourceLine" id="cb17-9" data-line-number="9">    }</a>
<a class="sourceLine" id="cb17-10" data-line-number="10">    RenderDefaultTemplate(w, <span class="st">&quot;views/step2.gohtml&quot;</span>)</a>
<a class="sourceLine" id="cb17-11" data-line-number="11">}</a></code></pre></div>
<p>And, finally, modify <code>main()</code>:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode go"><code class="sourceCode go"><a class="sourceLine" id="cb18-1" data-line-number="1"><span class="kw">func</span> main() {</a>
<a class="sourceLine" id="cb18-2" data-line-number="2">  client = messagebird.New(&lt;enter-your-apikey&gt;)</a>
<a class="sourceLine" id="cb18-3" data-line-number="3"></a>
<a class="sourceLine" id="cb18-4" data-line-number="4">  <span class="co">// The rest of your applicaiton...</span></a>
<a class="sourceLine" id="cb18-5" data-line-number="5">}</a></code></pre></div>
<h2 id="verifying-the-code">Verifying the code</h2>
<p>If everything runs smoothly, the user will check their phone, enter their verification code and submit the form. We now need to send the verification token along with the ID received in the <code>clientVerify</code> object in <code>step2()</code>.</p>
<p>In <code>step3.gohtml</code>, let‚Äôs write the following code:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode html"><code class="sourceCode html"><a class="sourceLine" id="cb19-1" data-line-number="1">{{ define &quot;yield&quot; }}</a>
<a class="sourceLine" id="cb19-2" data-line-number="2">    <span class="kw">&lt;h1&gt;</span>Done!<span class="kw">&lt;/h1&gt;</span></a>
<a class="sourceLine" id="cb19-3" data-line-number="3">    <span class="kw">&lt;p&gt;</span>You have successfully verified your phone number.<span class="kw">&lt;/p&gt;</span></a>
<a class="sourceLine" id="cb19-4" data-line-number="4">{{ end }}</a></code></pre></div>
<p>Then, modify <code>step3()</code> in <code>main.go</code> to look like the following:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode go"><code class="sourceCode go"><a class="sourceLine" id="cb20-1" data-line-number="1"><span class="kw">func</span> step3(w http.ResponseWriter, r *http.Request) {</a>
<a class="sourceLine" id="cb20-2" data-line-number="2">    r.ParseForm()</a>
<a class="sourceLine" id="cb20-3" data-line-number="3">    token := r.FormValue(<span class="st">&quot;token&quot;</span>)</a>
<a class="sourceLine" id="cb20-4" data-line-number="4">    clientVerifyDone, err := verify.VerifyToken(client, clientVerify.ID, token)</a>
<a class="sourceLine" id="cb20-5" data-line-number="5">    <span class="kw">if</span> err != <span class="ot">nil</span> {</a>
<a class="sourceLine" id="cb20-6" data-line-number="6">        log.Println(err)</a>
<a class="sourceLine" id="cb20-7" data-line-number="7">    }</a>
<a class="sourceLine" id="cb20-8" data-line-number="8">    <span class="co">// Execute template and pass verify.Status as a variable into the step3.gohtml template.</span></a>
<a class="sourceLine" id="cb20-9" data-line-number="9">    RenderDefaultTemplate(w, <span class="st">&quot;views/step3.gohtml&quot;</span>)</a>
<a class="sourceLine" id="cb20-10" data-line-number="10">}</a></code></pre></div>
<p>In <code>step3()</code>, we parse the form data submitted in <code>step2</code> for the verification token, and send the token and the verification ID that we‚Äôve stored in <code>clientVerify</code> to the MessageBird servers with <code>verify.VerifyToken(client, clientVerify.ID, token)</code>.</p>
<h2 id="displaying-success-state-optional">Displaying success state (optional)</h2>
<p>When we submit the verification token, the MessageBird servers responds with another <code>Verify</code> object, which we store in <code>clientVerifyDone</code>. If the token is successfully verified, then the value of <code>clientVerifyDone.Status</code> would be ‚Äúverified‚Äù. We can use this to display a success state in <code>step3.gohtml</code>.</p>
<p>To do this, we have to alter our <code>RenderDefaultTemplate()</code> function to allow us to pass data into the <code>ExecuteTemplate()</code> method.</p>
<p>In <code>main.go</code>, modify <code>RenderDefaultTemplate()</code>:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode go"><code class="sourceCode go"><a class="sourceLine" id="cb21-1" data-line-number="1"><span class="kw">func</span> RenderDefaultTemplate(w http.ResponseWriter, thisView <span class="dt">string</span>, data <span class="kw">interface</span>{}) {</a>
<a class="sourceLine" id="cb21-2" data-line-number="2">  <span class="co">// ...</span></a>
<a class="sourceLine" id="cb21-3" data-line-number="3">    err = t.ExecuteTemplate(w, <span class="st">&quot;default&quot;</span>, data)</a>
<a class="sourceLine" id="cb21-4" data-line-number="4">    <span class="kw">if</span> err != <span class="ot">nil</span> {</a>
<a class="sourceLine" id="cb21-5" data-line-number="5">        log.Fatal(err)</a>
<a class="sourceLine" id="cb21-6" data-line-number="6">    }</a>
<a class="sourceLine" id="cb21-7" data-line-number="7">}</a></code></pre></div>
<p>Then, modify the <code>RenderDefaultTemplate()</code> calls in our handlers to look like the following:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode go"><code class="sourceCode go"><a class="sourceLine" id="cb22-1" data-line-number="1"><span class="kw">func</span> step1(...){</a>
<a class="sourceLine" id="cb22-2" data-line-number="2">  <span class="co">// ...</span></a>
<a class="sourceLine" id="cb22-3" data-line-number="3">  RenderDefaultTemplate(w,<span class="st">&quot;views/step1.gohtml&quot;</span>,<span class="ot">nil</span>)</a>
<a class="sourceLine" id="cb22-4" data-line-number="4">}</a>
<a class="sourceLine" id="cb22-5" data-line-number="5"><span class="kw">func</span> step2(...){</a>
<a class="sourceLine" id="cb22-6" data-line-number="6">  <span class="co">// ...</span></a>
<a class="sourceLine" id="cb22-7" data-line-number="7">  RenderDefaultTemplate(w,<span class="st">&quot;views/step1.gohtml&quot;</span>,<span class="ot">nil</span>)</a>
<a class="sourceLine" id="cb22-8" data-line-number="8">}</a>
<a class="sourceLine" id="cb22-9" data-line-number="9"><span class="kw">func</span> step3(...){</a>
<a class="sourceLine" id="cb22-10" data-line-number="10">  <span class="co">// ...</span></a>
<a class="sourceLine" id="cb22-11" data-line-number="11">  RenderDefaultTemplate(w,<span class="st">&quot;views/step3.gohtml&quot;</span>,clientVerifyDone)</a>
<a class="sourceLine" id="cb22-12" data-line-number="12">}</a></code></pre></div>
<p>This allows the <code>step3.gohtml</code> template to access data we pass through our <code>RenderDefaultTemplate</code> function. We then need to do the following:</p>
<ol type="1">
<li>Write a struct that we will pass into the <code>RenderDefaultTemplate</code> function.</li>
<li>The struct should contain one attribute, ‚ÄúSuccess‚Äù, that is set to either <code>true</code> or <code>false</code>.</li>
<li>If token verification is successful, ‚ÄúSuccess‚Äù should be set to <code>true</code>. Otherwise, it should be set to <code>false</code>.</li>
<li>Modify <code>step3.gohtml</code> to display a success state if token verification is successful.</li>
</ol>
<p>Now, let‚Äôs modify <code>step3()</code> in <code>main.go</code>:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode go"><code class="sourceCode go"><a class="sourceLine" id="cb23-1" data-line-number="1"><span class="kw">func</span> step3(w http.ResponseWriter, r *http.Request) {</a>
<a class="sourceLine" id="cb23-2" data-line-number="2">  <span class="co">// ...</span></a>
<a class="sourceLine" id="cb23-3" data-line-number="3">  <span class="kw">type</span> successState <span class="kw">struct</span> {</a>
<a class="sourceLine" id="cb23-4" data-line-number="4">    Success <span class="dt">bool</span></a>
<a class="sourceLine" id="cb23-5" data-line-number="5">  }</a>
<a class="sourceLine" id="cb23-6" data-line-number="6">  <span class="kw">var</span> s successState</a>
<a class="sourceLine" id="cb23-7" data-line-number="7"></a>
<a class="sourceLine" id="cb23-8" data-line-number="8">  <span class="kw">if</span> clientVerifyDone.Status == <span class="st">&quot;verified&quot;</span> {</a>
<a class="sourceLine" id="cb23-9" data-line-number="9">    s = successState{Success: <span class="ot">true</span>}</a>
<a class="sourceLine" id="cb23-10" data-line-number="10">  } <span class="kw">else</span> {</a>
<a class="sourceLine" id="cb23-11" data-line-number="11">    s = successState{Success: <span class="ot">false</span>}</a>
<a class="sourceLine" id="cb23-12" data-line-number="12">  }</a>
<a class="sourceLine" id="cb23-13" data-line-number="13">  </a>
<a class="sourceLine" id="cb23-14" data-line-number="14">  RenderDefaultTemplate(w, <span class="st">&quot;views/step3.gohtml&quot;</span>, s)</a>
<a class="sourceLine" id="cb23-15" data-line-number="15">}</a></code></pre></div>
<p>Then, rewrite <code>step3.gohtml</code> such that it looks like this:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode html"><code class="sourceCode html"><a class="sourceLine" id="cb24-1" data-line-number="1">{{ define &quot;yield&quot; }}</a>
<a class="sourceLine" id="cb24-2" data-line-number="2">  {{ if .Success }}</a>
<a class="sourceLine" id="cb24-3" data-line-number="3">    <span class="kw">&lt;h1&gt;</span>Done!<span class="kw">&lt;/h1&gt;</span></a>
<a class="sourceLine" id="cb24-4" data-line-number="4">    <span class="kw">&lt;p&gt;</span>You have successfully verified your phone number.<span class="kw">&lt;/p&gt;</span></a>
<a class="sourceLine" id="cb24-5" data-line-number="5">  {{ else }}</a>
<a class="sourceLine" id="cb24-6" data-line-number="6">    <span class="kw">&lt;h1&gt;</span>Error<span class="kw">&lt;/h1&gt;</span></a>
<a class="sourceLine" id="cb24-7" data-line-number="7">    <span class="kw">&lt;p&gt;</span>Something went wrong. Please try again<span class="kw">&lt;/p&gt;</span></a>
<a class="sourceLine" id="cb24-8" data-line-number="8">  {{ end }}</a>
<a class="sourceLine" id="cb24-9" data-line-number="9">{{ end }}</a></code></pre></div>
<h2 id="testing">Testing</h2>
<p>You‚Äôre done! To check if your application works, go to your project folder in your terminal and run:</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb25-1" data-line-number="1"><span class="ex">go</span> build main.go</a>
<a class="sourceLine" id="cb25-2" data-line-number="2"><span class="ex">./main</span></a></code></pre></div>
<p>Then, point your browser to <a href="http://localhost:8080/" class="uri">http://localhost:8080/</a> and try to verify your own phone number.</p>
<h2 id="nice-work">Nice work!</h2>
<p>You now have a running integration of MessageBird‚Äôs Verify API!</p>
<p>You can now leverage the flow, code snippets and UI examples from this tutorial to build your own two factor authentication system. Don‚Äôt forget to download the code from the <a href="https://github.com/messagebirdguides/verify-guide-go">MessageBird Developer Guides GitHub repository</a>.</p>
<h2 id="next-steps">Next steps</h2>
<p>Want to build something similar but not quite sure how to get started? Please feel free to let us know at support@messagebird.com, we‚Äôd love to help!</p>
